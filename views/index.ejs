<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>SMART MIRROR</title>

 	<link href="/css/bootstrap.min.css" media="all" rel="stylesheet" type="text/css" />
    <script src="/js/jquery.min.js" type="text/javascript"></script>
    <link href="/css/index.css" rel="stylesheet">

    
  </head>


  <body class="background text-white" onload="printClock()">
    <div class="centered"> SMART MIRROR </div>
    <div class="time" id="clock"></div>
    <img class="img-responsive" src="/img/<%= weatherImg %>" alt="">
    <br>
    현재 기온: <%= temp %>
    강수 확률: <%= rainPro %>
    <br>
    습도: <%= wetPercent %>
    최저 기온: <%= minTemp %>
    <br>
    <%= userStyle %>
    <br>
    <input type="text" name = "stationName">
    <button type="submit" id = "search">submit</button>
    <div id="busWaitingReturn"></div>
    
  </body>
  
  <script>

  $(document).ready(function(){

      $("#search").click(function(){

          $.ajax({ 

        	type :'post',

        	data :{

        		stationName : $('input[name="stationName"]').val(),

        	},  

	        url : '/searchStationNum',

	        dataType : 'json',

	        success: whenSuccess,

	        error: whenError

     	    });

      });

    });

    function whenSuccess(retdata){
      var result= '';
      var index = 0;
    	$.each(retdata.busNum, function(){
    	  if( !retdata.predictTime[index] )
    	    {
    	      result += retdata.busNum[index++] +'번 버스는 차고지 대기 중 입니다. <br>';
    	      return true;
    	    }
    	  result += retdata.busNum[index] +'번 버스 도착 '+ retdata.predictTime[index++] +'분 전 <br>';
      });
      $("#busWaitingReturn").html(result);
    }

    function whenError(){
        alert("Error");
    }



  function printClock() {
      

      var clock = document.getElementById("clock");
      var currentDate = new Date();
      var calendar = currentDate.getFullYear() + "-" + (currentDate.getMonth()+1) + "-" + currentDate.getDate()
      var amPm = 'AM';
      var currentHours = addZeros(currentDate.getHours(),2); 
      var currentMinute = addZeros(currentDate.getMinutes() ,2);
      var currentSeconds =  addZeros(currentDate.getSeconds(),2);
      
      if(currentHours >= 12){ 
      	amPm = 'PM';
      	currentHours = addZeros(currentHours - 12,2);
      }
      clock.innerHTML = currentHours+":"+currentMinute+":"+currentSeconds +" <span style='font-size:50px;'>"+ amPm+"</span>";
      
      setTimeout("printClock()",1000);
  }

  function addZeros(num, digit) {
  	  var zero = '';
  	  num = num.toString();
  	  if (num.length < digit) {
  	    for (i = 0; i < digit - num.length; i++) {
  	      zero += '0';
  	    }
  	  }
  	  return zero + num;
  }

</script>
 
</html>
